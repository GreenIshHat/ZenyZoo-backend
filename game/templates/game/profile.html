{% extends "base.html" %}
{% block title %}{{ user.username }}'s Profile{% endblock %}

<style>

.profile-deck-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(46px, 1fr));
  gap: 4px;
  max-width: 320px;
  min-height: 50px;
  margin: 0 auto;
}

.profile-deck-grid .card {
  position: relative;
  width: 44px;
  height: 44px;
  background: #111;
  border-radius: 6px;
  overflow: hidden;
  box-shadow: 0 1px 4px #0002;
  display: flex;
  align-items: center;
  justify-content: center;
}
.profile-deck-grid .card-face {
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  border-radius: 6px;
  /* Add this for images */
  display: block;
}
.profile-deck-grid .stat {
  position: absolute;
  font-size: 0.60rem;
  color: #ffd700;
  background: #222e;
  border-radius: 3px;
  padding: 1px 2px;
  pointer-events: none;
}
.profile-deck-grid .stat-top { top: 2px; left: 18px; }
.profile-deck-grid .stat-right { top: 18px; right: 2px; }
.profile-deck-grid .stat-bottom { bottom: 2px; left: 18px; }
.profile-deck-grid .stat-left { top: 18px; left: 2px; }


</style>


{% block content %}

  <h2>{{ user.username }}'s Profile</h2>

  <h3>Your Record</h3>
  <ul>
    <li>Total matches: {{ stats.total }}</li>
    <li>Won: {{ stats.wins }}</li>
    <li>Lost: {{ stats.losses }}</li>
    <li>Draws: {{ stats.draws }}</li>
    <li>vs Humans: {{ stats.human_played }}</li>
    <li>vs Bots: {{ stats.bot_played }}</li>
  </ul>

  {% if h2h %}
    <h4>Head-to-Head</h4>
    <table>
      <thead>
        <tr>
          <th>Opponent</th><th>Played</th><th>W</th><th>L</th><th>D</th>
        </tr>
      </thead>
      <tbody>
        {% for name, rec in h2h.items %}
          <tr>
            <td>{{ name }}</td>
            <td>{{ rec.played }}</td>
            <td>{{ rec.wins }}</td>
            <td>{{ rec.losses }}</td>
            <td>{{ rec.draws }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}

  <h3>Battle Deck</h3>
  <div class="profile-deck-grid">
    {% for pc in battle_deck %}
      <div class="card">
        <div class="card-face"
             style="background-image: url('{{ pc.card.image.url }}');"
             title="{{ pc.card.name }}"></div>
        <span class="stat stat-top">{{ pc.card.strength_top }}</span>
        <span class="stat stat-right">{{ pc.card.strength_right }}</span>
        <span class="stat stat-bottom">{{ pc.card.strength_bottom }}</span>
        <span class="stat stat-left">{{ pc.card.strength_left }}</span>
      </div>
    {% empty %}
      <p>You havenâ€™t selected your deck yet. <a href="{% url 'choose_battle_deck' %}">Select Deck</a></p>
    {% endfor %}
  </div>

  <h3>Owned Cards</h3>
  <div class="profile-deck-grid">
    {% for pc in all_cards %}
      <div class="card">
        <div class="card-face"
             style="background-image: url('{{ pc.card.image.url }}');"
             title="{{ pc.card.name }}"></div>
        <span class="stat stat-top">{{ pc.card.strength_top }}</span>
        <span class="stat stat-right">{{ pc.card.strength_right }}</span>
        <span class="stat stat-bottom">{{ pc.card.strength_bottom }}</span>
        <span class="stat stat-left">{{ pc.card.strength_left }}</span>
      </div>
    {% empty %}
      <p>You have no cards yet.</p>
    {% endfor %}
  </div>

{% endblock %}
